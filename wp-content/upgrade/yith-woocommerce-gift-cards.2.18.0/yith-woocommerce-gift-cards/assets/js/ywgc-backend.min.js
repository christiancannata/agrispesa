jQuery(function(u){function s(t,n){return parseFloat(u(n).data("amount").toString().replace(",","."))<parseFloat(u(t).data("amount").toString().replace(",","."))?1:-1}u(document).on("click","a.remove-amount",function(t){t.preventDefault();var t=u(this),n=(t=t.closest("span.variation-amount")).index(),a=u(".yith-wcmcs-currencies-prices"),e=t.parent().parent().parent().parent().hasClass("yith-wcmcs-currencies-prices--row");t.remove(),a.length&&!e&&u(".yith-wcmcs-currencies-prices--row .variation-amount-list").each(function(){u(this).children().eq(n).remove()}),u(document.body).trigger("removed_gift_card_amount")}),u(document).on("click","a.add-new-amount",function(t){t.preventDefault();var n,o=(t=u(this)).parent().find("#gift_card-amount").val(),a=t.closest("span.add-new-amount-section"),t=t.parent().parent().find("span.variation-amount-list"),e=u(".yith-wcmcs-currencies-prices"),a=a.parent().parent().hasClass("yith-wcmcs-currencies-prices--row"),i=u(".variation-amount-aux"),c=t.find("span.variation-amount").length,r=!0;(!o.length||parseFloat(o.replace(",","."))<=0)&&(r=!1,u(".add-new-amount-section #gift_card-amount").addClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),u(".add-new-amount-section .ywgc-currency-symbol-enter-amount").addClass("ywgc-wrong-amount-alert"),u(".ywgc-tooltip-container.ywgc-invalid-amount").removeClass("ywgc-hidden")),t.find("span.variation-amount .yith_wcgc_multi_currency").each(function(){parseFloat(u(this).val().replace(",","."))==parseFloat(o.replace(",","."))&&(r=!1,u(".add-new-amount-section #gift_card-amount").addClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),u(".add-new-amount-section .ywgc-currency-symbol-enter-amount").addClass("ywgc-wrong-amount-alert"),u(".ywgc-tooltip-container.ywgc-amount-already-added").removeClass("ywgc-hidden"))}),r&&(i.clone().insertBefore(i).removeClass("ywgc-hidden variation-amount-aux").addClass("variation-amount new-amount"),i=u(".variation-amount.new-amount input.yith_wcgc_multi_currency"),n=u(".variation-amount.new-amount input.gift_card-amount"),i.attr("name","gift-card-amounts["+c+"]"),i.val(o),i.parent().data("amount",o),n.val(o),n.data("amount",o),u(".variation-amount.new-amount").data("amount",o),u(".variation-amount.new-amount").removeClass("new-amount"),t.find("span.variation-amount ").sort(s).appendTo(t),u("#gift_card-amount").val(""),u("#gift_card-amount").selectionStart=0,u("#gift_card-amount").selectionEnd=0,e.length&&!a&&u(".yith-wcmcs-currencies-prices--row .variation-amount-list").each(function(){var t=u(this).find(".variation-amount-aux-currency"),t=(t.clone().insertBefore(t).removeClass("ywgc-hidden variation-amount-aux-currency").addClass("variation-amount new-amount-currency"),u(".variation-amount.new-amount-currency input.yith_wcgc_multi_currency")),n=u(".variation-amount.new-amount-currency input.gift_card-amount"),a=n.data("currency-id"),e=u(this).parent().parent().parent().data("currency-options"),e=function(t,n,a,e,o,i){var c=parseFloat(t)/parseFloat(n)*parseFloat(a);switch(o){case"round-up":var r=Math.pow(10,e);c=-Math.round(-1*c*r-.5)/r;break;case"round-down":c-=.5/Math.pow(10,e);break;case"round-int-up":c=Math.ceil(c);break;case"round-int-down":c=Math.floor(c)}return c=c.toFixed(e),(c=Math.max(parseFloat(c.replace(i,".")),0).toString().replace(".",i))<0?0:c}(parseFloat(o.replace(",",".")),1,e.rate,e.decimals,e.round,e.decimal_separator);t.attr("name","yith_wcgc_multi_currency[gift-card-amounts]["+a+"]["+c+"]"),t.val(e),t.parent().data("amount",e),n.val(e),n.data("amount",e),u(".variation-amount.new-amount-currency").data("amount",e).removeClass("new-amount-currency"),u(this).find("span.variation-amount").sort(s).appendTo(u(this))}),u(document.body).trigger("added_gift_card_amount"))}),u(document).on("input",".add-new-amount-section #gift_card-amount",function(){u(this).removeClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),u(".add-new-amount-section .ywgc-currency-symbol-enter-amount").removeClass("ywgc-wrong-amount-alert"),u(".ywgc-tooltip-container").addClass("ywgc-hidden")}),u(document).on("keypress","input#gift_card-amount",function(t){13===event.which&&(t.preventDefault(),u(this).parent().find("a.add-new-amount").click())}),u(document).on("focusout","input.gift_card-amount",function(t){t.preventDefault();t=u(this).parent().find(".gift_card-amount").val();u(this).parent().find(".yith_wcgc_multi_currency").val(t)}),u(document).on("change",'input[name="ywgc_physical_gift_card"]',function(t){var n=u(this).prop("checked");u('input[name="_virtual"]').prop("checked",!n)}),u(document).on("click",".image-gallery-reset",function(t){t.preventDefault(),u("#ywgc-card-header-image img").remove(),u("#ywgc_product_image_id").val(0)}),u("body .ywgc_order_sold_as_gift_card").each(function(){u(this).parent("td").find(".wc-order-item-name").hide()}),u("._manage_stock_field").addClass("show_if_gift-card").show(),"undefined"!=typeof jQuery.fn.datepicker&&u(".ywgc-expiration-date-picker").datepicker({dateFormat:ywgc_data.date_format,minDate:1});var e=u("button.ywgc-actions:first").text();u(document).on("click","button.ywgc-actions",function(t){t.preventDefault();var n=u(this),t=n.prev("#ywgc_direct_link").text(),a=u("#ywgc_copied_to_clipboard").text();navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(t).then(()=>{n.text(a)},()=>{console.log("Copy to clipboard failed")}),setTimeout(function(){n.text(e)},1e3)}),u(document).on("change",".ywgc-toggle-enabled input",function(){var t="yes"===u(this).val()?"yes":"no",n=u(this).closest(".ywgc-toggle-enabled"),a=n.data("gift-card-id");n.block({message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0}),u.ajax({type:"POST",data:{action:"ywgc_toggle_enabled_action",id:a,enabled:t},url:ajaxurl,success:function(t){"undefined"!=typeof t.error&&alert(t.error)},complete:function(){n.unblock()}})}),"yes"===u(".ywgc-override-product-settings input").val()&&(u(".ywgc-custom-amount-field").removeClass("ywgc-hidden"),u(".minimal-amount-field").removeClass("ywgc-hidden"),u(".maximum-amount-field").removeClass("ywgc-hidden")),u(document).on("change",".ywgc-override-product-settings > input",function(){"yes"==("yes"===u(this).val()?"yes":"no")?(u(".ywgc-custom-amount-field").show(),"yes"===u(".ywgc-custom-amount-field input").val()&&(u(".minimal-amount-field").show(),u(".maximum-amount-field").show())):(u(".ywgc-custom-amount-field").hide(),"yes"===u(".ywgc-custom-amount-field input").val()&&(u(".minimal-amount-field").hide(),u(".maximum-amount-field").hide()))}),"yes"===u(".ywgc-custom-amount-field input").val()&&"yes"==u(".ywgc-override-product-settings input").val()?(u(".minimal-amount-field").removeClass("ywgc-hidden"),u(".maximum-amount-field").removeClass("ywgc-hidden")):(u(".minimal-amount-field").addClass("ywgc-hidden"),u(".maximum-amount-field").addClass("ywgc-hidden")),u(document).on("change",".ywgc-custom-amount-field input",function(){"yes"==("yes"===u(this).val()?"yes":"no")?(u(".minimal-amount-field").show(),u(".maximum-amount-field").show()):(u(".minimal-amount-field").hide(),u(".maximum-amount-field").hide())}),"yes"===u(".ywgc-add-discount-settings input").val()&&u(".ywgc-add-discount-settings-container").removeClass("ywgc-hidden"),u(document).on("change",".ywgc-add-discount-settings input",function(){"yes"==("yes"===u(this).val()?"yes":"no")?u(".ywgc-add-discount-settings-container").show():u(".ywgc-add-discount-settings-container").hide()}),"yes"===u(".ywgc-expiration-settings input").val()&&u(".ywgc-expiration-settings-container").removeClass("ywgc-hidden"),u(document).on("change",".ywgc-expiration-settings input",function(){"yes"==("yes"===u(this).val()?"yes":"no")?u(".ywgc-expiration-settings-container").show():u(".ywgc-expiration-settings-container").hide()}),u(document).on("mouseover","table tr.type-gift_card",function(t){u(this).css("background-color","#f1f6f8"),u(this).find("td.gift_card_actions .ywgc-actions").show()}),u(document).on("mouseout","table tr.type-gift_card",function(t){u(this).removeAttr("style"),u(this).find("td.gift_card_actions .ywgc-actions").hide()}),u(document).ready(function(){u(".ywgc-product-edit-page-amount-options .variation-amount-list").has("span.variation-amount").length||u(".ywgc-product-edit-page-multi-currency-options").hide()}),u(document).on("added_gift_card_amount",function(t){u(".ywgc-product-edit-page-multi-currency-options").show();var n=u(".ywgc-product-edit-page-amount-options .variation-amount-list span.variation-amount").length;u(".ywgc-product-edit-page-multi-currency-options .yith-wcmcs-currencies-prices .yith-wcmcs-currencies-prices--row").each(function(){var t=u(this).find(".variation-amount-list span.variation-amount").length;n!=t&&(t=Math.abs(n-t),u(this).find(".variation-amount-list span.variation-amount:nth-last-child(-n+"+t+")").remove())})}),u(document).on("removed_gift_card_amount",function(t){u(".ywgc-product-edit-page-amount-options .variation-amount-list").has("span").length||u(".ywgc-product-edit-page-multi-currency-options").hide();var n=u(".ywgc-product-edit-page-amount-options .variation-amount-list span.variation-amount").length;u(".ywgc-product-edit-page-multi-currency-options .yith-wcmcs-currencies-prices .yith-wcmcs-currencies-prices--row").each(function(){var t=u(this).find(".variation-amount-list span.variation-amount").length;n!=t&&(t=Math.abs(n-t)+1,u(this).find(".variation-amount-list span.variation-amount:nth-last-child(-n+"+t+")").remove())})})});