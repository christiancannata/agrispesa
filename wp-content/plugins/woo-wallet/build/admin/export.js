(()=>{"use strict";!function(t,e){var r=function(t){this.$form=t,this.xhr=!1,this.$form.find(".terawallet-exporter-progress").val(0),this.processStep=this.processStep.bind(this),t.on("submit",{teraWalletExportForm:this},this.onSubmit),this.$form.find(".terawallet-exporter-type").on("change",{teraWalletExportForm:this},this.onChangeType).change()};r.prototype.onSubmit=function(e){e.preventDefault();var r=new Date,a="terawallet-transaction-export-"+r.getDate()+"-"+(r.getMonth()+1)+"-"+r.getFullYear()+"-"+r.getTime()+".csv";e.data.teraWalletExportForm.$form.addClass("terawallet-exporter__exporting"),e.data.teraWalletExportForm.$form.find(".terawallet-exporter-progress").val(0),e.data.teraWalletExportForm.$form.find(".terawallet-exporter-button").prop("disabled",!0),e.data.teraWalletExportForm.processStep(1,t(this).serialize(),"",a)},r.prototype.onChangeType=function(){t(this).is(":checked")?t(".export-transaction-settings-fields").hide():t(".export-transaction-settings-fields").show()},r.prototype.processStep=function(r,a,o,l){var n=this,s=t(".terawallet-exporter-type").is(":checked")?"balance":"transactions",p=t(".terawallet-exporter-columns").val(),i=t(".terawallet-exporter-users").val(),c=t(".terawallet-exporter-from-date").val(),u=t(".terawallet-exporter-to-date").val();t.ajax({type:"POST",url:ajaxurl,data:{form:a,action:"terawallet_do_ajax_transaction_export",step:r,export_type:s,columns:o,selected_columns:p,selected_users:i,start_date:c,end_date:u,filename:l,security:terawallet_export_params.export_nonce},dataType:"json",success:function(t){t.success&&("done"===t.data.step?(n.$form.find(".terawallet-exporter-progress").val(t.data.percentage),e.location=t.data.url,setTimeout((function(){n.$form.removeClass("terawallet-exporter__exporting"),n.$form.find(".terawallet-exporter-button").prop("disabled",!1)}),200)):(n.$form.find(".terawallet-exporter-progress").val(t.data.percentage),n.processStep(parseInt(t.data.step,10),a,t.data.columns,l)))}}).fail((function(t){e.console.log(t)}))},t.fn.terawallet_export_form=function(){return new r(this),this},t(".terawallet-exporter").terawallet_export_form(),t(".terawallet-exporter-users").selectWoo({language:{inputTooShort:function(){return terawallet_export_params.i18n.inputTooShort},noResults:function(){return terawallet_export_params.i18n.no_resualt},searching:function(){return terawallet_export_params.i18n.searching}},minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(t){return{action:"terawallet_export_user_search",security:terawallet_export_params.search_user_nonce,autocomplete_field:"ID",term:t.term}},processResults:function(e){return{results:t.map(e,(function(t){return{id:t.value,text:t.label}}))}}}})}(jQuery,window)})();