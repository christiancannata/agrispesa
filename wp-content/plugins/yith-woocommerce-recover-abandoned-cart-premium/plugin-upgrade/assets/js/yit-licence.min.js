(function(a){var n=a("body");a(document);var f=a("#yith-license-activation"),r=a(f).find(".error-message.email"),m=a(f).find(".error-message.license-key"),y=f.find(".user-email"),z=f.find(".licence-key");a.yith_license_animation=function(b,d,c){var e=a("#licence-check-section-wrapper"),g=a("#no-license-enabled-message"),h=a("#yith-no-license-to-enabled-message"),k=a("#yith-license-from-wrapper");"beforeSend"==c?(b.animate({opacity:.4},100),d.addClass("show")):"afterSend"==c?(b.animate({opacity:1},
  100),d.removeClass("show")):"removeLine"==c?(c=b.parent("tbody"),c=c.find("tr"),0===a("#yith-products-list").find("option").length&&(k.fadeIn(),h.fadeOut()),1==c.length?(g.fadeIn(),e.fadeOut(),b.remove()):b.fadeOut(),d.removeClass("show")):"addLine"==c&&(c=b.parent("tbody"),c=c.find("tr"),1===a("#yith-products-list").find("option").length&&(k.fadeOut(),h.fadeIn()),1==c.length&&(b.show(),b=e,g.fadeOut()),b.fadeIn(),d.removeClass("show"))};var D=function(b){b.off("click").on("click",function(d,c){d.preventDefault();
  a(this);var e=a("#yith-license-activation"),g=a("#yith-products-list"),h=g.find("option:selected"),k=h.data("init"),u=h.data("marketplace"),t=a("#yith-licence-notice-wrapper"),p=a("#yith-licence-notice"),v=null,q=a("#products-to-active").find(".spinner"),w=!1,A=a("#licence-check-update");a("#product_init").val(k);a("#marketplace").val(u);v=e.serialize();r.add(m).empty();r.add(m).removeClass("visible");email_check=n.find("input.licence-key").trigger("focusout");license_key_check=n.find("input.user-email").trigger("focusout");
  if(email_check.hasClass("error")||license_key_check.hasClass("error"))w=!0;!1===w?jQuery.ajax({type:"POST",url:"undefined"!=typeof ajaxurl?ajaxurl:yith_ajax.url,data:v,beforeSend:function(){a.yith_license_animation(e,q,"beforeSend")},success:function(l){a.yith_license_animation(e,q,"afterSend");if(!0===l.activated){var C=a("#yith-enabled-license"),B=a(l.template);C.find("tbody").prepend(B);B.hide();a("html, body").animate({scrollTop:A.offset().top},500).promise().done(function(){y.add(z).attr("value",
      "");h.remove();product_count=e.data("count");console.log(product_count);e.removeClass("count-"+product_count);product_count=1*product_count-1;e.data("count",product_count).addClass("count-"+product_count);1==product_count||0==product_count?(g.attr("disabled",!0),a(".yith-select-plugin").text(licence_message.choose_the_plugin_singular)):(g.attr("disabled",!1),a(".yith-select-plugin").text(licence_message.choose_the_plugin_plural))});a.yith_license_animation(B,q,"addLine");p.find("p.yith-licence-notice-message").html("#"+
      l.code+": "+l.activation_message);t.fadeIn();x()}else!1!==l?(m.text("#"+l.code+": "+l.error),r.add(m).addClass("visible")):(m.text(licence_message.server),m.addClass("visible")),e.addClass("error");"undefined"!==typeof l.debug&&console.log(l.debug)}}):a.yith_license_animation(e,q,"afterSend")})},E=function(b){b.off("click").on("click",function(d){d.preventDefault();a(this);var c=a("#licence-check-update"),e=a("#yith-enabled-license");d=c.serialize();jQuery.ajax({type:"POST",url:ajaxurl,data:d,beforeSend:function(){a.yith_license_animation(e,
    c.find("div.spinner"),"beforeSend")},success:function(g){a(".product-licence-activation").empty().replaceWith(g.template)},complete:function(){x()}})})},F=function(b){b.off("click").on("click",function(d){d.preventDefault();if(1==(1==script_info.is_debug?!0:confirm(licence_message.are_you_sure))){var c=a(this),e=c.parent("td").parent("tr");d=c.data("product-init");var g=c.data("product-id"),h=c.data("action"),k=a("#yith-licence-notice-wrapper"),u=a("#yith-licence-notice"),t=a("#activated-products").find(".spinner");
  jQuery.ajax({type:"POST",url:ajaxurl,data:{action:h,product_init:d,product_id:g},beforeSend:function(){a.yith_license_animation(e,t,"beforeSend")},success:function(p){if(0==p)u.find("p.yith-licence-notice-message").html(licence_message.server),k.fadeIn();else{if(0==p.activated){a.yith_license_animation(e,t,"removeLine");var v=a("#yith-products-list"),q=c.data("textdomain"),w=c.data("product-init"),A=c.data("marketplace"),l=c.data("displayname");q=a('<option data-textdomain="'+q+'" data-init="'+w+
      '" data-marketplace="'+A+'">'+l+"</option>");v.append(q);product_count=f.data("count");f.removeClass("count-"+product_count);product_count=1*product_count+1;f.data("count",product_count).addClass("count-"+product_count);1==product_count||0==product_count?(products_list.attr("disabled",!0),a(".yith-select-plugin").text(licence_message.choose_the_plugin_singular)):(products_list.attr("disabled",!1),a(".yith-select-plugin").text(licence_message.choose_the_plugin_plural));x()}"undefined"!=typeof p.error&&
    (u.find("p.yith-licence-notice-message").html(p.error),k.fadeIn())}}})}})},G=function(b){b.off("click").on("click",function(d){d.preventDefault();if(1==script_info.is_debug||confirm(licence_message.are_you_sure)){var c=a(this),e=a("#yith-expired-license-count"),g=1*e.data("count"),h=c.parent("td").parent("tr"),k=g-1;d=c.data("product-init");var u=c.data("product-id");c=c.data("action");var t=a("#activated-products").find(".spinner");jQuery.ajax({type:"POST",url:ajaxurl,data:{action:c,product_init:d,
    product_id:u,force_delete:!0},beforeSend:function(){a.yith_license_animation(h,t,"beforeSend")},success:function(p){a.yith_license_animation(h,t,999==p.code?"removeLine":"afterSend");e.removeClass("count-"+g).addClass("count-"+k);e.data("count",k);e.find(".expired-count").empty().text(k)}})}})};n.on("focusout","input.user-email",function(){var b=f.find(".user-email"),d=b.val().trim();b.val(d);(b=""===d)||(b=!(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)).test(d));
  b&&(r.text(licence_message.error.replace("%field%",licence_message.email)),r.addClass("visible"),y.addClass("require error"))}).on("focusout","input.licence-key",function(){var b=f.find(".licence-key"),d=b.val().trim();b.val(d);(b=""===d)||(b=!(new RegExp(/^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$/g)).test(d));b&&(m.text(licence_message.error.replace("%field%",licence_message.license_key)),m.addClass("visible"),z.addClass("require error"))});var x=function(){var b=
  a(".licence-activation"),d=a(".licence-check"),c=a(".licence-deactive"),e=a(".remove-expired-plugin");n=a("body");a(document);f=a("#yith-license-activation");r=f.find(".error-message.email");m=f.find(".error-message.license-key");y=f.find(".user-email");z=f.find(".licence-key");products_list=a("#yith-products-list");product_count=f.data("count");D(b);E(d);F(c);G(e);n.trigger("wc-enhanced-select-init")};x();n.on("click",".yit-changelog-button",function(b){a("#TB_window").remove()});n.on("focusin",
  "input.user-email, input.licence-key",function(){var b=a(this);b.removeClass("require").removeClass("error");b.hasClass("user-email")&&r.text("");b.hasClass("licence-key")&&m.text("")});a(function(){var b=n.find("input.user-email"),d=n.find("input.licence-key");""!=b.val()&&b.trigger("focusout");""!=d.val()&&d.trigger("focusout")})})(jQuery);
