jQuery(function(s){function u(t,a){return parseFloat(s(a).data("amount").toString().replace(",","."))<parseFloat(s(t).data("amount").toString().replace(",","."))?1:-1}s(document).on("click","a.remove-amount",function(t){t.preventDefault();var t=s(this),a=(t=t.closest("span.variation-amount")).index(),n=s(".yith-wcmcs-currencies-prices"),e=t.parent().parent().parent().parent().hasClass("yith-wcmcs-currencies-prices--row");t.remove(),n.length&&!e&&s(".yith-wcmcs-currencies-prices--row .variation-amount-list").each(function(){s(this).children().eq(a).remove()}),s(document.body).trigger("removed_gift_card_amount")}),s(document).on("click","a.add-new-amount",function(t){t.preventDefault();var a,i=(t=s(this)).parent().find("#gift_card-amount").val(),n=t.closest("span.add-new-amount-section"),t=t.parent().parent().find("span.variation-amount-list"),e=s(".yith-wcmcs-currencies-prices"),n=n.parent().parent().hasClass("yith-wcmcs-currencies-prices--row"),o=s(".variation-amount-aux"),c=t.find("span.variation-amount").length,r=!0;(!i.length||parseFloat(i.replace(",","."))<=0)&&(r=!1,s(".add-new-amount-section #gift_card-amount").addClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),s(".add-new-amount-section .ywgc-currency-symbol-enter-amount").addClass("ywgc-wrong-amount-alert"),s(".ywgc-tooltip-container.ywgc-invalid-amount").removeClass("ywgc-hidden")),t.find("span.variation-amount .yith_wcgc_multi_currency").each(function(){parseFloat(s(this).val().replace(",","."))==parseFloat(i.replace(",","."))&&(r=!1,s(".add-new-amount-section #gift_card-amount").addClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),s(".add-new-amount-section .ywgc-currency-symbol-enter-amount").addClass("ywgc-wrong-amount-alert"),s(".ywgc-tooltip-container.ywgc-amount-already-added").removeClass("ywgc-hidden"))}),r&&(o.clone().insertBefore(o).removeClass("ywgc-hidden variation-amount-aux").addClass("variation-amount new-amount"),o=s(".variation-amount.new-amount input.yith_wcgc_multi_currency"),a=s(".variation-amount.new-amount input.gift_card-amount"),o.attr("name","gift-card-amounts["+c+"]"),o.val(i),o.parent().data("amount",i),a.val(i),a.data("amount",i),s(".variation-amount.new-amount").data("amount",i),s(".variation-amount.new-amount").removeClass("new-amount"),t.find("span.variation-amount ").sort(u).appendTo(t),s("#gift_card-amount").val(""),s("#gift_card-amount").selectionStart=0,s("#gift_card-amount").selectionEnd=0,e.length&&!n&&s(".yith-wcmcs-currencies-prices--row .variation-amount-list").each(function(){var t=s(this).find(".variation-amount-aux-currency"),t=(t.clone().insertBefore(t).removeClass("ywgc-hidden variation-amount-aux-currency").addClass("variation-amount new-amount-currency"),s(".variation-amount.new-amount-currency input.yith_wcgc_multi_currency")),a=s(".variation-amount.new-amount-currency input.gift_card-amount"),n=a.data("currency-id"),e=s(this).parent().parent().parent().data("currency-options"),e=function(t,a,n,e,i,o){var c=parseFloat(t)/parseFloat(a)*parseFloat(n);switch(i){case"round-up":var r=Math.pow(10,e);c=-Math.round(-1*c*r-.5)/r;break;case"round-down":c-=.5/Math.pow(10,e);break;case"round-int-up":c=Math.ceil(c);break;case"round-int-down":c=Math.floor(c)}return c=c.toFixed(e),(c=Math.max(parseFloat(c.replace(o,".")),0).toString().replace(".",o))<0?0:c}(parseFloat(i.replace(",",".")),1,e.rate,e.decimals,e.round,e.decimal_separator);t.attr("name","yith_wcgc_multi_currency[gift-card-amounts]["+n+"]["+c+"]"),t.val(e),t.parent().data("amount",e),a.val(e),a.data("amount",e),s(".variation-amount.new-amount-currency").data("amount",e).removeClass("new-amount-currency"),s(this).find("span.variation-amount").sort(u).appendTo(s(this))}),s(document.body).trigger("added_gift_card_amount"))}),s(document).on("input",".add-new-amount-section #gift_card-amount",function(){s(this).removeClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),s(".add-new-amount-section .ywgc-currency-symbol-enter-amount").removeClass("ywgc-wrong-amount-alert"),s(".ywgc-tooltip-container").addClass("ywgc-hidden")}),s(document).on("keypress","input#gift_card-amount",function(t){13===event.which&&(t.preventDefault(),s(this).parent().find("a.add-new-amount").click())}),s(document).on("focusout","input.gift_card-amount",function(t){t.preventDefault();t=s(this).parent().find(".gift_card-amount").val();s(this).parent().find(".yith_wcgc_multi_currency").val(t)}),s(document).on("change",'input[name="ywgc_physical_gift_card"]',function(t){var a=s(this).prop("checked");s('input[name="_virtual"]').prop("checked",!a)}),s(document).on("click",".image-gallery-reset",function(t){t.preventDefault(),s("#ywgc-card-header-image img").remove(),s("#ywgc_product_image_id").val(0)}),s("body .ywgc_order_sold_as_gift_card").each(function(){s(this).parent("td").find(".wc-order-item-name").hide()}),s("._manage_stock_field").addClass("show_if_gift-card").show(),"undefined"!=typeof jQuery.fn.datepicker&&s(".ywgc-expiration-date-picker").datepicker({dateFormat:ywgc_data.date_format,minDate:1});var e=s("button.ywgc-actions:first").text();s(document).on("click","button.ywgc-actions",function(t){t.preventDefault();var a=s(this),t=a.prev("#ywgc_direct_link").text(),n=s("#ywgc_copied_to_clipboard").text();navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(t).then(()=>{a.text(n)},()=>{console.log("Copy to clipboard failed")}),setTimeout(function(){a.text(e)},1e3)}),s(document).on("change",".ywgc-toggle-enabled input",function(){var t="yes"===s(this).val()?"yes":"no",a=s(this).closest(".ywgc-toggle-enabled"),n=a.data("gift-card-id");a.block({message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0}),s.ajax({type:"POST",data:{action:"ywgc_toggle_enabled_action",id:n,enabled:t},url:ajaxurl,success:function(t){"undefined"!=typeof t.error&&alert(t.error)},complete:function(){a.unblock()}})}),"yes"===s(".ywgc-override-product-settings input").val()&&(s(".ywgc-custom-amount-field").removeClass("ywgc-hidden"),s(".minimal-amount-field").removeClass("ywgc-hidden"),s(".maximum-amount-field").removeClass("ywgc-hidden")),s(document).on("change",".ywgc-override-product-settings > input",function(){"yes"==("yes"===s(this).val()?"yes":"no")?(s(".ywgc-custom-amount-field").show(),"yes"===s(".ywgc-custom-amount-field input").val()&&(s(".minimal-amount-field").show(),s(".maximum-amount-field").show())):(s(".ywgc-custom-amount-field").hide(),"yes"===s(".ywgc-custom-amount-field input").val()&&(s(".minimal-amount-field").hide(),s(".maximum-amount-field").hide()))}),"yes"===s(".ywgc-custom-amount-field input").val()&&"yes"==s(".ywgc-override-product-settings input").val()?(s(".minimal-amount-field").removeClass("ywgc-hidden"),s(".maximum-amount-field").removeClass("ywgc-hidden")):(s(".minimal-amount-field").addClass("ywgc-hidden"),s(".maximum-amount-field").addClass("ywgc-hidden")),s(document).on("change",".ywgc-custom-amount-field input",function(){"yes"==("yes"===s(this).val()?"yes":"no")?(s(".minimal-amount-field").show(),s(".maximum-amount-field").show()):(s(".minimal-amount-field").hide(),s(".maximum-amount-field").hide())}),"yes"===s(".ywgc-add-discount-settings input").val()&&s(".ywgc-add-discount-settings-container").removeClass("ywgc-hidden"),s(document).on("change",".ywgc-add-discount-settings input",function(){"yes"==("yes"===s(this).val()?"yes":"no")?s(".ywgc-add-discount-settings-container").show():s(".ywgc-add-discount-settings-container").hide()}),"yes"===s(".ywgc-expiration-settings input").val()&&s(".ywgc-expiration-settings-container").removeClass("ywgc-hidden"),s(document).on("change",".ywgc-expiration-settings input",function(){"yes"==("yes"===s(this).val()?"yes":"no")?s(".ywgc-expiration-settings-container").show():s(".ywgc-expiration-settings-container").hide()}),s(document).on("mouseover","table tr.type-gift_card",function(t){s(this).css("background-color","#f1f6f8"),s(this).find("td.gift_card_actions .ywgc-actions").show()}),s(document).on("mouseout","table tr.type-gift_card",function(t){s(this).removeAttr("style"),s(this).find("td.gift_card_actions .ywgc-actions").hide()}),s(document).ready(function(){s(".ywgc-product-edit-page-amount-options .variation-amount-list").has("span.variation-amount").length||s(".ywgc-product-edit-page-multi-currency-options").hide()}),s(document).on("added_gift_card_amount",function(t){s(".ywgc-product-edit-page-multi-currency-options").show();var a=s(".ywgc-product-edit-page-amount-options .variation-amount-list span.variation-amount").length;s(".ywgc-product-edit-page-multi-currency-options .yith-wcmcs-currencies-prices .yith-wcmcs-currencies-prices--row").each(function(){var t=s(this).find(".variation-amount-list span.variation-amount").length;a!=t&&(t=Math.abs(a-t),s(this).find(".variation-amount-list span.variation-amount:nth-last-child(-n+"+t+")").remove())})}),s(document).on("removed_gift_card_amount",function(t){s(".ywgc-product-edit-page-amount-options .variation-amount-list").has("span").length||s(".ywgc-product-edit-page-multi-currency-options").hide();var a=s(".ywgc-product-edit-page-amount-options .variation-amount-list span.variation-amount").length;s(".ywgc-product-edit-page-multi-currency-options .yith-wcmcs-currencies-prices .yith-wcmcs-currencies-prices--row").each(function(){var t=s(this).find(".variation-amount-list span.variation-amount").length;a!=t&&(t=Math.abs(a-t)+1,s(this).find(".variation-amount-list span.variation-amount:nth-last-child(-n+"+t+")").remove())})}),s(document).on("click",".toggle-settings",function(t){t.preventDefault(),s(this).closest(".yith-ywgc-row").toggleClass("active");t=s(this).data("target");s("#"+t).slideToggle()}),s(document).on("click",".yith-ywgc-save-settings",function(t){t.preventDefault(),s(this).closest("form").find(".wp-switch-editor.switch-html").trigger("click");t=s(this.closest(".email-settings")).attr("id"),t={action:"yith_ywgc_save_email_settings",params:s(this).closest("form").serialize(),email_key:t,security:ywgc_data.save_email_settings_nonce};s.ajax({type:"POST",data:t,url:ajaxurl,success:function(t){var a=s(".yith-ywgc-row.active");a.find(".email-settings").slideToggle(),a.toggleClass("active")}})}),s(document).on("change","#yith-ywgc-email-status",function(){var t={action:"yith_ywgc_save_mail_status",enabled:s(this).val(),email_key:s(this).closest(".yith-plugin-fw-onoff-container ").data("email_key"),security:ywgc_data.save_email_status_nonce};s.ajax({type:"POST",data:t,url:ajaxurl,success:function(t){console.log("Email status updated")}})})});