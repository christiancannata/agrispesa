function receiveSettings(e){if(e.origin===location.origin)return receiveInternalData(e);if(e.origin!==checkProtocol(trustpilot_integration_settings.TRUSTPILOT_INTEGRATION_APP_URL))return;const t=e.data;if("string"==typeof t)if(t.startsWith("sync:")||t.startsWith("showPastOrdersInitial:")){const e=t.split(":"),s={action:"handle_past_orders"};s[e[0]]=e[1],this.submitPastOrdersCommand(s)}else if(t.startsWith("resync")){const e={action:"handle_past_orders",resync:"resync"};this.submitPastOrdersCommand(e)}else if(t.startsWith("issynced")){const e={action:"handle_past_orders",issynced:"issynced"};this.submitPastOrdersCommand(e)}else if(t.startsWith("check_product_skus")){const e=t.split(":"),s={action:"check_product_skus"};s.skuSelector=e[1],this.submitCheckProductSkusCommand(s)}else"signup_data"===t?this.sendSignupData():"update"===t?console.log("Do not support"):"reload"===t?reloadSettings():t&&tryParseJson(t)&&JSON.parse(t).TrustBoxPreviewMode?TrustBoxPreviewMode(t):handleJSONMessage(t)}function receiveInternalData(e){const t=e.data;if(t&&"string"==typeof t&&tryParseJson(t)){const e=JSON.parse(t);e&&"updatePageUrls"===e.type&&submitSettings(e),e&&"loadCategoryProductInfo"===e.type&&requestCategoryInfo(),e&&"newTrustBox"===e.type&&submitSettings(e)}}function handleJSONMessage(e){if(tryParseJson(e)){const t=JSON.parse(e);if(t.window)this.updateIframeSize(t);else if("submit"===t.type)this.submitSettings(t);else if(t.trustbox){document.getElementById("trustbox_preview_frame").contentWindow.postMessage(JSON.stringify(t.trustbox),"*")}}}function encodeSettings(e){let t="";for(const s in e)t+=`${s}=${e[s]}&`;return t.substring(0,t.length-1)}function getFormValues(e){let t={};for(const s in e.elements){const n=e.elements[s];"INPUT"===n.nodeName&&(t[n.name]=n.value)}return t}function tryParseJson(e){try{JSON.parse(e)}catch(e){return!1}return!0}function getTPNonce(){const e=document.getElementById("trustpilot_iframe_form");let t="";return t=e&&e.childNodes.length>0?e.childNodes[0].value:document.getElementById("_wpnonce").value}function submitPastOrdersCommand(e){const t=new XMLHttpRequest;t.open("POST",ajaxurl,!0),t.setRequestHeader("X-CSRF-TOKEN",getTPNonce()),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):sendPastOrdersInfo(t.response))},t.send(encodeSettings(e))}function submitCheckProductSkusCommand(e){const t=new XMLHttpRequest;t.open("POST",ajaxurl),t.setRequestHeader("X-CSRF-TOKEN",getTPNonce()),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings(e))}function sendSignupData(){const e=new XMLHttpRequest;e.open("POST",ajaxurl),e.setRequestHeader("X-CSRF-TOKEN",getTPNonce()),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4===e.readyState)if(e.status>=400)console.log(`callback error: ${e.response} ${e.status}`);else{const t=document.getElementById("configuration_iframe"),s=JSON.stringify({trustpilot_signup_data:e.response});t.contentWindow.postMessage(s,t.dataset.transfer)}},e.send(encodeSettings({action:"get_signup_data"}))}function TrustBoxPreviewMode(e){const t=JSON.parse(e),s=document.getElementById("trustpilot-trustbox-preview");t.TrustBoxPreviewMode.enable?s.hidden=!1:s.hidden=!0}function reloadSettings(){const e=new XMLHttpRequest;e.open("POST",ajaxurl),e.setRequestHeader("X-CSRF-TOKEN",getTPNonce()),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4===e.readyState)if(e.status>=400)console.log(`callback error: ${e.response} ${e.status}`);else{const t=document.getElementById("configuration_iframe");t.contentWindow.postMessage(e.response,t.dataset.transfer)}},e.send(encodeSettings({action:"reload_trustpilot_settings"}))}function submitSettings(e){let t={action:"handle_save_changes"};"updatePageUrls"===e.type?t.pageUrls=encodeURIComponent(JSON.stringify(e.pageUrls)):"newTrustBox"===e.type?t.customTrustBoxes=encodeURIComponent(JSON.stringify(e)):(t.settings=encodeURIComponent(JSON.stringify(e.settings)),document.getElementById("trustbox_preview_frame").dataset.settings=btoa(t.settings));const s=new XMLHttpRequest;s.open("POST",ajaxurl),s.setRequestHeader("X-CSRF-TOKEN",getTPNonce()),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(encodeSettings(t))}function requestCategoryInfo(){const e=new XMLHttpRequest;e.open("POST",ajaxurl),e.setRequestHeader("X-CSRF-TOKEN",getTPNonce()),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===e.readyState&&(e.status>=400?console.log(`callback error: ${e.response} ${e.status}`):window.postMessage(JSON.stringify({categoryProductsData:e.response,basis:"plugin"}),window.origin))},e.send(encodeSettings({action:"get_category_product_info"}))}function updateIframeSize(e){const t=document.getElementById("configuration_iframe");t&&(t.height=e.window.height+"px")}function sendSettings(){const e=document.getElementById("configuration_iframe"),t=e.dataset,s=JSON.parse(atob(t.settings));if(s.trustbox||(s.trustbox={}),s.trustbox.pageUrls=JSON.parse(atob(t.pageUrls)),s.pluginVersion=t.pluginVersion,s.source=t.source,s.version=t.version,s.basis="plugin",s.productIdentificationOptions=JSON.parse(t.productIdentificationOptions),s.isFromMarketplace=t.isFromMarketplace,s.configurationScopeTree=JSON.parse(atob(t.configurationScopeTree)),s.pluginStatus=JSON.parse(atob(t.pluginStatus)),s.mode=t.mode,s.trustbox.trustboxes&&t.sku)for(trustbox of s.trustbox.trustboxes)trustbox.sku=t.sku;if(s.trustbox.trustboxes&&t.name)for(trustbox of s.trustbox.trustboxes)trustbox.name=t.name;e.contentWindow.postMessage(JSON.stringify(s),checkProtocol(t.transfer))}function checkProtocol(e){if(e.startsWith("//")){return window.location.protocol+e}return e}function sendPastOrdersInfo(e){const t=document.getElementById("configuration_iframe"),s=t.dataset;void 0===e&&(e=s.pastOrders),t.contentWindow.postMessage(e,checkProtocol(s.transfer))}window.addEventListener("message",this.receiveSettings);
//# sourceMappingURL=integrationScript.min.js.map
