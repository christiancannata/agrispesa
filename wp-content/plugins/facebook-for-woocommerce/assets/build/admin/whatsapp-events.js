jQuery(document).ready(function(e){var o=e("#order-placed-active-status"),a=e("#order-placed-inactive-status");facebook_for_woocommerce_whatsapp_events.order_placed_enabled?(a.hide(),o.show()):(o.hide(),a.show());var t=e("#order-fulfilled-active-status"),n=e("#order-fulfilled-inactive-status");facebook_for_woocommerce_whatsapp_events.order_fulfilled_enabled?(n.hide(),t.show()):(t.hide(),n.show());var r=e("#order-refunded-active-status"),c=e("#order-refunded-inactive-status");facebook_for_woocommerce_whatsapp_events.order_refunded_enabled?(c.hide(),r.show()):(r.hide(),c.show());var s=e("#woocommerce-whatsapp-save-order-confirmation"),_=e("#woocommerce-whatsapp-cancel-order-confirmation");e("#woocommerce-whatsapp-manage-order-placed, #woocommerce-whatsapp-manage-order-fulfilled, #woocommerce-whatsapp-manage-order-refunded").click(function(o){let a=e(o.target).attr("id").replace("woocommerce-whatsapp-","");a=a.replaceAll("-","_");let t=new URL(window.location.href),n=new URLSearchParams(t.search);n.set("view",a),t.search=n.toString(),window.location.href=t.toString()}),e("#library-template-content").load(facebook_for_woocommerce_whatsapp_events.ajax_url,function(){e.post(facebook_for_woocommerce_whatsapp_events.ajax_url,{action:"wc_facebook_whatsapp_fetch_library_template_info",nonce:facebook_for_woocommerce_whatsapp_events.nonce,event:facebook_for_woocommerce_whatsapp_events.event},function(o){if(o.success){const n=facebook_for_woocommerce_whatsapp_events.event,r={ORDER_REFUNDED:{"{{1}}":"{{$amount}}"}},c={ORDER_PLACED:{"{{1}}":"{{first_name}}","{{2}}":"#{{order_number}}"},ORDER_FULFILLED:{"{{1}}":"{{first_name}}","{{2}}":"#{{order_number}}"},ORDER_REFUNDED:{"{{1}}":"{{first_name}}","{{2}}":"{{$amount}}","{{3}}":"#{{order_number}}"}},s=JSON.parse(o.data).data[0];var a=e.parseHTML(s.header)[0].textContent;a=a.replace(/{{\d+}}/g,function(e){return r[n][e]});var t=e.parseHTML(s.body)[0].textContent;if(t=(t=t.replace(/{{\d+}}/g,function(e){return c[n][e]})).replace(/\n/g,"<br>"),"ORDER_REFUNDED"===facebook_for_woocommerce_whatsapp_events.event)e("#library-template-content").html(`\n                        <h3>Header</h3>\n                        <p>${a}</p>\n                        <h3>Body</h3>\n                        <p>${t}</p>\n                    `).show();else{const o=e.parseHTML(s.buttons[0].text)[0].textContent;e("#library-template-content").html(`\n                    <h3>Header</h3>\n                    <p>${a}</p>\n                    <h3>Body</h3>\n                    <p>${t}</p>\n                    <h3>Call to action</h3>\n                    <p>${o}</p>\n                `).show()}console.log("Whatsapp Library Template call succeeded",o)}else{console.log("Whatsapp Library Template call failed",o);const a=`\n                <div class="notice-error">\n                  <p>${facebook_for_woocommerce_whatsapp_finish.i18n.generic_error}</p>\n                </div>\n              `;e("#events-error-notice").html(a).show()}})}),s.click(function(o){var a=e("#manage-event-language").val(),t=e('input[name="template-status"]:checked').val(),n=e("#woocommerce-whatsapp-save-loading-state");s.addClass("fbwa-button-disabled"),_.addClass("fbwa-button-disabled"),n.show(),e.post(facebook_for_woocommerce_whatsapp_events.ajax_url,{action:"wc_facebook_whatsapp_upsert_event_config",nonce:facebook_for_woocommerce_whatsapp_events.nonce,event:facebook_for_woocommerce_whatsapp_events.event,language:a,status:t},function(o){if(o.success){let e=new URL(window.location.href),a=new URLSearchParams(e.search);a.set("view","utility_settings"),e.search=a.toString(),window.location.href=e.toString(),console.log("Whatsapp Event Config has been updated",o)}else{n.hide(),s.removeClass("fbwa-button-disabled"),_.removeClass("fbwa-button-disabled"),console.log("Whatsapp Event Config Update failure",o);const a=`\n                <div class="notice-error">\n                  <p>${facebook_for_woocommerce_whatsapp_finish.i18n.generic_error}</p>\n                </div>\n              `;e("#events-error-notice").html(a).show()}})}),e("#manage-event-language").load(facebook_for_woocommerce_whatsapp_events.ajax_url,function(){e.post(facebook_for_woocommerce_whatsapp_events.ajax_url,{action:"wc_facebook_whatsapp_fetch_supported_languages",nonce:facebook_for_woocommerce_whatsapp_events.nonce},function(o){if(o.success){const t=JSON.parse(o.data).supported_languages;e.each(t,function(o,a){var t=e.parseHTML(a.display_value)[0].textContent,n=e.parseHTML(a.locale)[0].textContent;e("#manage-event-language").append(e("<option></option>").text(t).val(n))});var a=function(){switch(facebook_for_woocommerce_whatsapp_events.event){case"ORDER_PLACED":return facebook_for_woocommerce_whatsapp_events.order_placed_language;case"ORDER_FULFILLED":return facebook_for_woocommerce_whatsapp_events.order_fulfilled_language;case"ORDER_REFUNDED":return facebook_for_woocommerce_whatsapp_events.order_refunded_language;default:return null}}();e("#manage-event-language").val(a),console.log("Fetch supported language call succeeded")}else{const a=`\n                <div class="notice-error">\n                  <p>${190===JSON.parse(o.data.body).error.code?facebook_for_woocommerce_whatsapp_events.i18n.token_invalidated_error:facebook_for_woocommerce_whatsapp_finish.i18n.generic_error}</p>\n                </div>\n              `;e("#events-error-notice").html(a).show()}})})});